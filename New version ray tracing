import pygame, pygame.gfxdraw, random, math

pygame.init()
screen = pygame.display.set_mode([800, 800])
center = (400, 400)
targetdist = 100
targetangle = 260
hit=False
bruh=True
clock = pygame.time.Clock()
forward=False
down=False
left=False
right=False
class wall(pygame.sprite.Sprite):
    def __init__(self,width,height,position):
        super().__init__()
        self.positionx=position[0]
        self.positiony=position[1]
        self.width=width
        self.height=height
        self.rect =pygame.draw.rect(screen, (255,0,0), (position[0], position[1], width, height))
    def cameramove(self,left,right,up,down):
        if left:
            self.positionx+=5
        elif right:
            self.positionx-=5
        if up:
            self.positiony+=5
        elif down:
            self.positiony-=5
        self.rect = pygame.draw.rect(screen, (255, 255, 255), (self.positionx, self.positiony, self.width, self.height))


wallist=[]
wallist.append(wall(100,100,(100,100)))
wallist.append(wall(100,100,(200,200)))


while bruh==True:
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            bruh = False
        if event.type == pygame.MOUSEMOTION:
            if event.pos[0]-center[0] != 0:
                x = event.pos[1]-center[1]
                y = event.pos[0]-center[0]
                targetangle = math.degrees(math.atan(x/y))
                if x > 0 and y < 0 or x < 0 and y < 0:
                    targetangle += 180
        if event.type == pygame.KEYDOWN:

            if event.key == pygame.K_w:
                forward = True
            if event.key == pygame.K_s:
                down = True
            if event.key == pygame.K_a:
                left = True
            if event.key == pygame.K_d:
                right = True

        if event.type == pygame.KEYUP:
            if event.key == pygame.K_w:
                forward = False
            if event.key == pygame.K_s:
                down = False
            if event.key == pygame.K_a:
                left = False
            if event.key == pygame.K_d:
                right = False
    screen.fill((0, 0, 0))
    for x in range(len(wallist)):
        wallist[x].cameramove(left,right,forward,down)
    pointlist = [center]
    for x in range(-30, 31):
        y=targetangle+x
        hit=False
        currenttargetangle = targetangle+x
        targetposy = center[1]+(2 * math.sin(math.radians(y)) * targetdist)
        targetposx = center[0]+(2 * math.cos(math.radians(y)) * targetdist)

        xdisp=(targetposx-center[0])/targetdist
        ydisp = (targetposy - center[1]) / targetdist

        for y in range(targetdist):
            for z in range(len(wallist)):
                if wallist[z].rect.collidepoint((center[0]+xdisp*y),(center[1]+ydisp*y)):
                    pointlist.append(((center[0] + xdisp * y), (center[1] + ydisp * y)))
                    hit=True
                    break
            if hit:
                break
        if hit!=True:
            pointlist.append((targetposx, targetposy))
    pygame.gfxdraw.filled_polygon(screen,pointlist,(255,255,0))
    pygame.display.flip()
    clock.tick(60)
